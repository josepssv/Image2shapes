<!DOCTYPE html>
<html>

<head>
    <title>Turns an image into hundreds of them. Discover the shapes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" integrity="sha512-uaz5GpnQoE6t5echKlX8P52czvsIGgLPcvlzfvRubLZ1Hp8JemUDnbUiAahbVtPb+jUVrNETuXvAhDDF/N3M4w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <meta charset="utf-8">
    <script>
    </script>
    <style>
        html, body {
  margin: auto,auto;
  padding: 0;
  background-color:#111;
  font-size:20px;
  text-align:center;
  color:#444;
  font-family:arial;
}
canvas {
  display: block;
}
#drop-zone {
  border: 1px solid black;
  padding: 10px;
  background-color:#111;
  color:#ddd;
  height:200px;
}
.convert {
  background-color: #0000ff;
  color: white;
  padding: 10px 20px;
  margin: 20px 0;
  border-radius: 5px;
}
.butty {
 padding: 10px 20px;
  margin: 0;
 border-radius: 5px;
 height:40px;
}

.layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
.empieza {
  font-size: 30px;
  color: white;
  text-align: center;
  font-family: "Roboto", sans-serif;
  position: relative;
  text-shadow: 1px 1px 2px #000;
 
}
.otracapa {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #555;

}
.preload {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #999;
}
.capadibujo {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  background-color:#000;
  background-image: repeating-linear-gradient(36deg, rgba(15,19,15, 0.25), rgba(15,19,15, 0.25) 1px, transparent 0px, transparent 2px);
    content:".";
    display:block;
    clear:both;
    padding-bottom: 100px;
}
#canvasdiv {
  display: inline-block;
  text-align:center;
  position: relative;
}

table {
    background-color:#999;
    border-collapse:separate;
    border:solid black 1px;
    border-radius:6px;
    color: #000;
    display:inline-block;
}


</style>
</head>

<body>
    <main>
        <div class="layer">
            <div style="background-image:url(1000.png);display:inline-block;height:350px;width:680px;"></div>
            <h1 class="empieza" style="top:-300px;"><span style="font-size:20px;">Turns an image into hundreds of them </span><br>Discover the shapes<br>
                <button type="button" id="start" class="convert">Start</button>
            </h1>
        </div>
        <div class="otracapa" style="display:none;">
            <div id="drop-zone">
                <p>click to upload:</p>
                <div id="imageUpload"></div>
                <p style="display:none">Drag and drop files here to upload.</p>
            </div>
        </div>
        <div class="preload" style="display:none;"><br><span style="margin.top:100px;font-size:24px;">loading..</span></div>
        <div class="capadibujo" style="display:none;">
            <div id="bill" style="display:none;"></div>
            <div id="allimgs" style=""></div>
            <center>
            </center>
        </div>
        <div class="shape" style="z-index:1000;position:fixed;display:none;background-color:rgba(0,0,0,0.8);top:0px;left:0px;width:100%;height:100%;margin:0px;padding:0px;">
            <center>
                <div id="myShape" class="choid" style=""></div>
            </center>
        </div>
        <div id="footer" style="position: fixed; bottom: 0; margin-top: 0; padding-top: 0; vertical-align: top; width: 100%;  height: 40px; display:none;background-color:rgba(0,0,0,0.8); align-items: flex-start;">
            <button type="button" class="butty saveImages" style="background-color:#444;margin-left:44px;">Save Images</button>
            <button class="butty showSelected" style="background-color:#888;margin-left:33px;">Show selected</button>
            <button type="button" class="butty saveCode" style="background-color:#444;margin-left:44px;">Save code</button>
        </div>
    </main>
    <script>
    var angle;
    var angle2;
    var radius;
    var shape;
    var shape2;
    var offset = 0;
    var factor;

    var aangle1 = 0;
    var aangle2 = 0;
    var sangle = 0;
    var aini1 = 0;
    var aini2 = 0;

    var centerx = 0;
    var centery = 0;
    var diagonal2 = 100;
    var W = 400;
    var H = 400;
    var contmore = 1
    var clickCount = 1;
    var contSaved = 0;
    var coord;
    var inpt;
    var contdiv;
    var showr, showl, reloadi, savef, inum
    var contf = 1
    var pares = [3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5]
    var polis = [4, 6, 8, 10, 12, 16, 18, 20, 32, 64]
    var pary = [...pares]
    var poly = [...polis]
    //pares = [3.1, 3.2, 2.4, 3.3, 2.2, 3.2, 3.3, 3]
    var cfoto = [{ "w": 640, "h": 963, "n": 8, "W": 300, "o": 0, "d": 640, "id": "p0a2OHWO1TXUnHfq4zQVDG5lPa1AReHkVwjj39yKGlQ7Ot6QO1", "img": "" }]
    var caddy = [...cfoto]
    var slices = 24;
    var img;
    var started = false
    var imgsize = { w: 10, h: 10, propor: 1, cursor: 40 }
    var dallimgs
    var codehtml = ''
    var canvasbill
    var dmy
    var nfoto = []
    var nShape = 1;
    var savedSucure;
    const shapes = new Map();
    //const upscaler = new Upscaler({ model: DefaultUpscalerJSModel,  })
    //const upscaler = new Upscaler({ model: UpscalerJSMaximDeblurring, })
    //const upscaler = new Upscaler({   model: ESRGANLegacyGANS, })

    $(document).ready(function() {
        const buttonStart = $("#start");
        buttonStart.on("click", function() {
            $(".layer").hide();
            $(".otracapa").show();
            var inputImage = createFileInput(handleImg);
            inputImage.parent('imageUpload')
        });

        $(".shape").click(function(e) {
            console.log(',' + e.target.className + ', ' + caddy.length)
            if (e.target.className != ".selectef" || e.target.className != "convert addy") {
                $(".shape").hide();
                //$(".capadibujo").show();
                //
            }
        });

        $(".saveImages").on("click", function() {
            saveAllImages()
        });
        $(".saveCode").on("click", function() {
            saveCode()
        });
        $(".showSelected").click(function(e) {
            savedSecure = [...cfoto]
            cfoto = [...caddy]
            contf = 1
            codehtml = ''
            dallimgs.html('')

            loop()

        });
    });


    function handleImg(file) {
        if (file.type === "image") {
            $(".otracapa").hide();
            $(".preload").show();
            $(".capadibujo").show();
            //img2 = loadImage(file.data)

            img = loadImage(
                file.data,
                () => {
                    //alert('Selected file: ' + file.value);
                    //$(".preload").show();
                    canvasbill = createCanvas(W, H);

                    iniShapes()
                    canvasbill.parent('#bill')
                    dallimgs = select('#allimgs')

                    $(".preload").hide();
                    textSize(50);
                    frameRate(12)
                    imageMode(CENTER);
                    dmy = select('#myShape')
                    $('.shape').show()
                    reini(file.data, img.width, img.height)
                },
                () => print('Image Failed to Load.'),
            );

        };
    }

    function setup() {
        createMetaTag()
        noLoop()
    }

    function draw() {
        var tt = '<div style="color:#888;margin-top:100px;font-size:33px;">' + (contf) + ' ' + (cfoto.length - 1) + ' shapes</div>'
        $('#myShape').html(tt)
        //console.log('FOTO ',contf,cfoto.length)
        if (started) {
            if (contmore == 1) { select('#footer').show() }
            //dallimgs.html('<span style="margin-top:100px;font-size:33px;">'+contf+' '+cfoto.length-1+'</span>')
            slices = cfoto[contf].n
            var d = cfoto[contf].d
            var modo = 'triRegular'
            if (slices < 3) {
                modo = 'quad'
            }
            drawbill(contf, W, H, slices, d, modo)
            contf++
            if (contf >= cfoto.length) {
                noLoop()
                //$('.capadibujo').show()
                contf = cfoto.length
                poly = [...polis]
                pary = [...pares]
                codehtml += '<center><button type="button" class="convert more" id="m' + contmore + '" style="display:block;">More</button></center>'
                //codehtml+='<br><button class="convert showSelected" style="background-color:#888;margin-left:33px;">Show selected</button>'
                //codehtml +='<button type="button" class="convert saveImages" style="background-color:#444;margin-left:44px;">Save Images</button>'
                //codehtml +='<button type="button" class="convert saveCode" style="background-color:#444;margin-left:44px;">Save code</button></center>'
                //$("button").remove(".more");
                dallimgs.html(codehtml, true)
                $('#allimgs').scrollTop($('#allimgs').scrollHeight);
                $('.shape').fadeOut(1000)
                codehtml = ''
                $(".forma").on("click", function() {
                    //console.log(JSON.stringify())
                    var n = this.children[0].id
                    //console.log(n)
                    enhance(n)
                });
                $(".more").on("click", function() {
                    $('.shape').show()
                    contmore++
                    newRandco(cfoto[0].w, cfoto[0].h, 4, 4, 0)
                    console.log()
                    $("button").remove(".more");
                    //$("button").remove(".saveImages");
                    //$("button").remove(".saveCode");
                    //$("button").remove(".showSelected");
                    loop()
                });

            }
        }
    }

    function drawbill(conti, w, h, slices, diagonal, modo) {
        background(0, 0)
        clear()
        factor = 0.5
        var x = cfoto[conti].x;
        var y = cfoto[conti].y;
        var p = cfoto[conti].p;
        var ang = 1 * random(1)
        var ns = floor(random(0, polis.length))
        var nsides = polis[ns]
        var rotation = 0
        //////////////////////////////////
        //var rns=floor(random(0,pares.length))
        //shapes.get(pares[rns]).apply(null,[slices,diagonal,{scl:factor,rtt:0,trx:0,try:0},ang*random(1),x,y]);
        shapes.get(slices).apply(null, [p, diagonal, { scl: factor, rtt: rotation, trx: 0, try: 0 }, ang, x, y]);

        /////////////////////////////////////
        codehtml += '<div class="forma" style="vertical-align: top;margin:0px;padding:0px;display:inline-block;width:200px;height:200px;font-size:220px;background-color:transparent;"><img id="i' + contf + '" width="200px" height="200px" src="' + shape2.canvas.toDataURL() + '"></div>'

        //nfoto[contf]=shape2.canvas.toDataURL()
        if (conti % 4 == 0) { codehtml += '<br style="height: 0;">' }

    }


    function reini(iimg, w, h) {
        //img=loadImage(iimg)
        cfoto = [{ "w": 640, "h": 963, "n": 8, "W": 300, "o": 0, "d": 640, "id": "p0a2OHWO1TXUnHfq4zQVDG5lPa1AReHkVwjj39yKGlQ7Ot6QO1", "img": "" }]
        slices = cfoto[0].n
        cfoto[0].img = iimg
        started = true
        codehtml = ''
        nfoto = []
        cfoto[0].W = W
        cfoto[0].w = w
        cfoto[0].h = h
        cfoto[0].id = makeid(50)
        caddy = [...cfoto]
        nfoto = []
        contf = 1
        nShape = 1;
        dallimgs.html(codehtml)
        $('.shape').show()
        newRandco(cfoto[0].w, cfoto[0].h, 4, 4, 0)
        loop();
    }


    function info(d) {

    }

    function fillRandom(values, n) {
        const result = [];
        for (let i = 0; i < n; i++) {
            const randomIndex = Math.floor(Math.random() * values.length);
            result.push(values[randomIndex]);
        }
        return result;
    }
    //var actualn=0
    var imgN

    function enhance(n) {
        //$('.capadibujo').hide()
        var dla = select('.shape')
        nShape = n.replace(/^\D+/g, '');
        //alert(nn)
        //n=2
        //actualn=n
        dla.show()
        var dmy = select('#myShape')
        imgN = select('#' + n + '').attribute('src');
        var code = '<img class=".selectef" src="' + imgN + '" width="' + cfoto[0].W + 'px">';
        code += '<br><span style="color:#ddd;font-size:12px;">' + JSON.stringify(cfoto[nShape]) + '</span>';
        code += '<br><button class="convert addy">Add</button>'
        code += '<button class="convert simy" style="background-color:#a66;">Similary</button>'
        code += '<button class="convert usy" style="background-color:#a6a;">Use</button>'


        dmy.html(code)

        $(".addy").click(function(e) {
            console.log(JSON.stringify(cfoto[nShape]))
            caddy.push(cfoto[nShape])

        });
        $(".usy").click(function(e) {
            img = loadImage(imgN, () => {
                reini(imgN, cfoto[0].W, cfoto[0].W)
            });

        });
        $(".simy").click(function(e) {
            var rry = [cfoto[nShape].n, cfoto[nShape].n]
            var lly = [cfoto[nShape].p, cfoto[nShape].p]
            pary = fillRandom(rry, 10)
            poly = fillRandom(lly, 10)
            $('.shape').show()
            contmore++
            newRandco(cfoto[0].w, cfoto[0].h, 4, 4, 0)
            $("button").remove(".more");
            loop()
        });
    }

    var savi = null

    function saveAllImages() {
        var images = document.getElementsByTagName('img');
        var srcList = [];
        var i = 0;
        var nimages = images.length
        if (nimages < 7) {
            var savi = setInterval(function() {
                if (i < nimages) {
                    srcList.push(images[i].src);
                    var link = document.createElement("a");
                    link.id = i;
                    link.download = makeid(8) + '.png'
                    link.href = images[i].src;
                    link.click();
                    i++;
                } else {
                    clearInterval(savi)
                    savi = null
                }
            }, 1500);
        }
    }

    function saveCode() {
        var nww = window.open('', 'newh')
        nww.document.write(JSON.stringify(cfoto))
    }

    function makeid(length) {
        var result = '';
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() *
                charactersLength));
        }
        return result;
    }



    function newco(w, h, rows, columns, npair) {

        var margin = random(10, 50)
        var cont = 1
        //cfoto.splice(1, cfoto.length);
        //var pr=pares[floor(random(0, pares.length))]
        //var npair=0
        for (let row = 0; row < rows; row++) {
            for (let column = 0; column < columns; column++) {
                let x = column * width / columns - margin;
                let y = row * height / rows - margin;
                if (x <= 0) {
                    x = parseInt(Math.random() * (cfoto[0].w - diagonal2))
                }
                if (y <= 0) {
                    y = parseInt(Math.random() * (cfoto[0].h - diagonal2))
                }

                cfoto.push({
                    x: x,
                    y: y,
                    n: pary[npair]
                });
                cont++
                //if(cont===floor(rows*columns/2)){npair++}
            }
        }
    }

    function newRandco(w, h, rows, columns, npair) {
        var pm = min(w, h)
        var margin = random(10, 50)
        var cont = 1
        //cfoto.splice(1, cfoto.length);
        let pr
        let dr
        let x, y, pxy
        //var npair=0
        for (let row = 0; row < rows; row++) {
            for (let column = 0; column < columns; column++) {
                //let x = column * width / columns - margin;
                //let y = row * height / rows - margin;
                //if (x <= 0) {
                x = parseInt(Math.random() * (cfoto[0].w - margin))
                //}
                //if (y <= 0) {
                y = parseInt(Math.random() * (cfoto[0].h - margin))
                //}
                pxy = min(w - x, h - y)
                dr = random(margin, w - pxy)
                pr = pary[floor(random(0, pary.length))]
                pl = poly[floor(random(0, poly.length))]
                cfoto.push({
                    x: x,
                    y: y,
                    n: pr,
                    d: dr,
                    p: pl
                });
                cont++
                //if(cont===floor(rows*columns/2)){npair++}
            }
        }
    }

    function newco1(w, h, rows, columns) {
        var pm = min(w, h)
        var rc = min(rows, columns)
        var margin = 1
        if (rc > 0) {
            margin = pm / rc
        }
        let minMargin = Math.min(w / columns, h / rows);
        if (margin > minMargin) {
            margin = minMargin;
        }
        margin = random(10, 50)
        var cont = 1
        cfoto.splice(1, cfoto.length);
        var pr = pary[floor(random(0, pary.length))]
        var npair = 0
        for (let row = 0; row < rows; row++) {
            for (let column = 0; column < columns; column++) {
                let x = column * width / columns - margin;
                let y = row * height / rows - margin;
                if (x <= 0) {
                    x = parseInt(Math.random() * (cfoto[0].w - diagonal2))
                }
                if (y <= 0) {
                    y = parseInt(Math.random() * (cfoto[0].h - diagonal2))
                }

                cfoto.push({
                    x: x,
                    y: y,
                    n: pary[npair]
                });
                cont++
                if (cont === floor(rows * columns / 2)) { npair++ }
            }
        }
    }


    function createMetaTag() {
        //https://openprocess4.org/sketch/790331

        //Mobile Devices by Oren Shoham

        let meta = createElement("meta");

        meta.attribute("name", "viewport");

        meta.attribute(
            "content",

            "user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width,height=device-height"
        );

        let head = select("head");

        meta.parent(head);
    }


    /////////////////////////
    // shapes.js
    ////////////////////////
    //const shapes = new Map();
    //iniShapes()

    function iniShapes() {
        shapes.set(3.1, (n, d, tr, an, x, y) => {
            var title = "symmetry triangle in square";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);


            var g = HALF_PI;
            var cutname = 1;
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            push();
            cutTriangle(x, y, cutname, l, d);
            shape2.scale(-1, 1);
            cutTriangle(x, y, cutname, l, d);
            pop();

            image(shape2, 0, 0);
            pop();
        });
        shapes.set(3.2, (n, d, tr, an, x, y) => {
            var title = "symmetry regular triangle";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);


            var g = HALF_PI;
            var cutname = 2;
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            push();
            cutTriangle(x, y, cutname, l, d);
            shape2.scale(-1, 1);
            cutTriangle(x, y, cutname, l, d);
            pop();
            push();
            shape2.rotate(HALF_PI + HALF_PI / 3);
            cutTriangle(x, y, cutname, l, d);
            shape2.scale(-1, 1);
            cutTriangle(x, y, cutname, l, d);
            pop();
            push();
            shape2.rotate(-HALF_PI - HALF_PI / 3);
            cutTriangle(x, y, cutname, l, d);
            shape2.scale(-1, 1);
            cutTriangle(x, y, cutname, l, d);
            pop();

            image(shape2, 0, 0);
            pop();
        });

        shapes.set(3.3, (n, d, tr, an, x, y) => {
            var title = "symmetry arrow from regular triangle aperture";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);
            var x = 33; //random(width);
            var y = 33 + random(0, 25); //random(height);
            var g = HALF_PI;
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            push();
            cutTriangle(x, y, 4, l, d, an);
            shape2.scale(-1, 1);
            cutTriangle(x, y, 4, l, d, an);

            pop();

            image(shape2, 0, 0);
            pop();
        });

        shapes.set(3.4, (n, d, tr, an, x, y) => {
            var title = "symmetry from isosceles triangle aperture";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);


            var g = HALF_PI;
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            push();
            cutTriangle(x, y, 5, l, d, an);
            shape2.scale(-1, 1);
            cutTriangle(x, y, 5, l, d, an);

            pop();

            image(shape2, 0, 0);
            pop();
        });

        shapes.set(3.5, (n, d, tr, an, x, y) => {
            var title = "sector circle and repeat n times with symm";
            var l = min(width, height);
            shape2 = createGraphics(l * 1, l * 1, WEBGL);
            tr.rtt += -HALF_PI;
            //random(height);
            shape2.push();
           
            //shape2.scale(tr.scl, tr.scl);
            shape2.scale(0.5, 0.5); 
            shape2.rotate(tr.rtt);
            shape2.translate(tr.trx, tr.try);

            
            //shape2.translate(450,450)
            var ang = TWO_PI / n;
            for (var a = 0; a < floor(n / 2); a++) {
                shape2.rotate(ang * 2);
                shape2.push();
                cutTriangle(x, y, 6, l, d, ang);
                shape2.scale(-1, 1);
                shape2.rotate(PI - ang * 2);
                cutTriangle(x, y, 6, l, d, ang);
                shape2.pop();
            }
            image(shape2, 0, 0);
            shape2.pop();
        });

        shapes.set(4.1, (n, d, tr, an, x, y) => {
            var title = "square sym";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);

            //random(height);
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            cutSquare(x, y, 1, l, d, null)
            shape2.scale(-1, 1);
            cutSquare(x, y, 1, l, d, null)
            image(shape2, 0, 0);
            pop();
        });
        shapes.set(4.2, (n, d, tr, an, x, y) => {
            var title = "square sym";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);


            var d2 = random(height / 2);
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            cutSquare(x, y, 2, l, d, d2)
            shape2.scale(-1, 1);
            cutSquare(x, y, 2, l, d, d2)
            image(shape2, 0, 0);
            pop();
        });

        shapes.set(4.3, (n, d, tr, an, x, y) => {
            var title = "diamond sector circular, star";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);
            tr.rtt += -HALF_PI
            //random(height);
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            var ang = TWO_PI / n;
            for (var a = 0; a < n; a++) {
                push();
                cutTriangle(x, y, 7, l, d, ang + (ang * 0));
                shape2.scale(-1, 1);
                shape2.rotate(PI - (ang * 2) * 2);
                cutTriangle(x, y, 7, l, d, ang + (ang * 0));
                pop();
                shape2.rotate(ang * 2 * a);
            }
            image(shape2, 0, 0);
            pop();
        });

        shapes.set(4.4, (n, d, tr, an, x, y) => {
            var title = "grid on square";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);
            tr.rtt += -HALF_PI;
            //random(height);
            push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            var ang = HALF_PI;
            cutSquare(x, y, 3, l, d, ang);
            shape2.scale(-1, 1);
            cutSquare(x, y, 3, l, d, ang);
            shape2.scale(-1, -1);
            cutSquare(x, y, 3, l, d, ang);
            shape2.scale(-1, 1);
            cutSquare(x, y, 3, l, d, ang);
            image(shape2, 0, 0);
            pop();
        });

        shapes.set(4.5, (n, d, tr, an, x, y) => {
            var title = "2 triangles in quart square";
            var l = min(width, height);
            shape2 = createGraphics(l, l, WEBGL);
            shape2.textureWrap(MIRROR);
            shape2.push();
            shape2.scale(tr.scl, tr.scl);
            shape2.rotate(tr.rtt);
            translate(width / 2 + tr.trx, height / 2 + tr.try);
            var ang = HALF_PI;
            var td = l / 2

            shape2.push()
            shape2.translate(-td, -td)
            cutTriangle(x, y, 9, l, d, ang);
            shape2.scale(-1, 1);
            shape2.rotate(-ang * 1);
            cutTriangle(x, y, 9, l, d, ang);
            shape2.pop()

            //shape2.rotate(-ang * 1);
            //shape2.scale(-1, -1);0

            shape2.push()
            shape2.translate(td * 1, td * 1)
            shape2.scale(-1, -1);
            cutTriangle(x, y, 9, l, d, ang);
            shape2.scale(-1, 1);
            shape2.rotate(-ang * 1);
            cutTriangle(x, y, 9, l, d, ang);
            shape2.pop()

            shape2.push()

            shape2.translate(-td, td)
            shape2.scale(1, -1)
            cutTriangle(x, y, 9, l, d, ang);
            shape2.scale(-1, 1);
            shape2.rotate(-ang * 1);
            cutTriangle(x, y, 9, l, d, ang);
            shape2.pop()

            shape2.push()
            shape2.translate(td, -td)
            shape2.scale(-1, 1)
            cutTriangle(x, y, 9, l, d, ang);
            shape2.scale(-1, 1);
            shape2.rotate(-ang * 1);
            cutTriangle(x, y, 9, l, d, ang);
            shape2.pop()
            image(shape2, 0, 0);
            shape2.pop();
        });

    }

    function cutTriangle(x, y, n, r, d, an = 1) {
        if (n == 1) {
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.vertex(0, r, 0, x, y + d);
            shape2.vertex(r, r, 0, x + d, y + d);
            shape2.vertex(0, -r, 0, x, y - d);
            shape2.endShape(CLOSE);
        }
        if (n == 2) {
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, 0 + r * sin(HALF_PI / 3), 0, x, y + d * sin(HALF_PI / 3));
            shape2.vertex(
                0 + r * cos(HALF_PI / 3),
                0 + r * sin(HALF_PI / 3),
                0,
                x + d * cos(HALF_PI / 3),
                y + d * sin(HALF_PI / 3)
            );
            shape2.vertex(0, 0, 0, x, y);
            shape2.endShape(CLOSE);
        }

        if (n == 3) {
            //Cut arrow 1/3 from regular triangle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, 0, 0, x, y);
            shape2.vertex(
                0 + r * cos(HALF_PI / 3),
                0 + r * sin(HALF_PI / 3),
                0,
                x + d * cos(HALF_PI / 3),
                y + d * sin(HALF_PI / 3)
            );
            shape2.vertex(
                0 + r * cos(-HALF_PI),
                0 + r * sin(-HALF_PI),
                0,
                x + d * cos(-HALF_PI),
                y + d * sin(-HALF_PI)
            );
            shape2.endShape(CLOSE);
        }

        if (n == 4) {
            //Cut arrow aperture from regular triangle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, 0, 0, x, y);

            shape2.vertex(
                0 + r * cos(an),
                0 + r * sin(an),
                0,
                x + d * cos(an),
                y + d * sin(an)
            );
            shape2.vertex(
                0 + r * cos(-HALF_PI),
                0 + r * sin(-HALF_PI),
                0,
                x + d * cos(-HALF_PI),
                y + d * sin(-HALF_PI)
            );
            shape2.endShape(CLOSE);
        }
        if (n == 5) {
            //Cut isosceles aperture from regular triangle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, r * sin(an), 0, x, y + d * sin(an));

            shape2.vertex(
                0 + r * cos(an),
                0 + r * sin(an),
                0,
                x + d * cos(an),
                y + d * sin(an)
            );
            shape2.vertex(
                0 + r * cos(-HALF_PI),
                0 + r * sin(-HALF_PI),
                0,
                x + d * cos(-HALF_PI),
                y + d * sin(-HALF_PI)
            );
            shape2.endShape(CLOSE);
        }
        if (n == 6) {
            //Cut section from circle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, 0, 0, x, y);

            shape2.vertex(
                0 + r * cos(an),
                0 + r * sin(an),
                0,
                x + d * cos(an),
                y + d * sin(an)
            );
            shape2.vertex(
                0 + r * cos(0),
                0 + r * sin(0),
                0,
                x + d * cos(0),
                y + d * sin(0)
            );
            shape2.endShape(CLOSE);
        }
        if (n == 7) {
            //Cut semi section deltoid from circle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(0, 0, 0, x, y);

            shape2.vertex(
                0 + r / 2 * cos(an),
                0 + r / 2 * sin(an),
                0,
                x + d / 2 * cos(an),
                y + d / 2 * sin(an)
            );
            shape2.vertex(
                0 + r * cos(0),
                0 + r * sin(0),
                0,
                x + d * cos(0),
                y + d * sin(0)
            );
            shape2.endShape(CLOSE);
        }
        if (n == 8) {
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.vertex(0, r, 0, x, y + d);
            shape2.vertex(r, r, 0, x + d, y + d);
            shape2.vertex(r, 0, 0, x + d, y);
            shape2.endShape(CLOSE);
        }
        if (n == 9) {
            //Cut semi section quart squrae centered
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            shape2.vertex(
                -r / 2,
                r / 2,
                0,
                x - d / 2,
                y + d / 2
            );
            shape2.vertex(
                r / 2,
                r / 2,
                0,
                x + d / 2,
                y + d / 2
            );
            shape2.vertex(
                r / 2,
                -r / 2,
                0,
                x + d / 2,
                y - d / 2
            );
            shape2.endShape(CLOSE);
        }
    }

    function cutSquare(x, y, n, r, d, an = 1) {
        if (n == 1) {
            //cut half square
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            d = d / 4;
            shape2.vertex(0, r, 0, x, y + d);
            shape2.vertex(r, r, 0, x + d, y + d);
            shape2.vertex(0, -r, 0, x, y - d);
            shape2.vertex(r, -r, 0, x + d, y - d);
            shape2.endShape(CLOSE);
        }
        if (n == 2) {
            // cut half rectangle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            d = d / 2;
            shape2.vertex(0, r, 0, x, y + d);
            shape2.vertex(an, r, 0, x + an, y + d);
            shape2.vertex(0, -r, 0, x, y - d);
            shape2.vertex(an, -r, 0, x + an, y - d);
            shape2.endShape(CLOSE);
        }
        if (n == 3) {
            // cut quarter rectangle
            shape2.beginShape(TRIANGLE_STRIP);
            shape2.texture(img);
            shape2.noStroke();
            shape2.imageMode(CENTER);
            d = d / 2;
            shape2.vertex(0, r, 0, x, y + d);
            shape2.vertex(r, r, 0, x + d, y + d);
            shape2.vertex(0, 0, 0, x, y);
            shape2.vertex(r, 0, 0, x + d, y);
            shape2.endShape(CLOSE);
        }

    }
    </script>
</body>

</html>